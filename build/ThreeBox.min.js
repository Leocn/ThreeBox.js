var \u03c0=Math.PI,\u03c4=2*\u03c0;(function(a){for(i in a)if(!window[i])throw"Error: ThreeBox requires "+a[i];})({THREE:"Three.js",tQuery:"tQuery.js (bundle)"});window.ThreeBox={};window.threeBox=function(a,c,b){return tQuery.createWorld(c).threeBox(a,b)};tQuery.MicroeventMixin&&(ThreeBox.MicroeventMixin=function(a){a=a.prototype;tQuery.MicroeventMixin(a);a.on=a.addEventListener;a.emit=a.dispatchEvent});
tQuery.World.register("threeBox",function(a,c){if(a&&!(a instanceof Node)){c=a;a=null}var b=a=a||document.body;if(a==document.body){b.style.margin=0;b.style.padding=0;b.style.overflow="hidden"}else{getComputedStyle(a);if(a.position=="static")a.position="relative"}this.appendTo(b);this.addThreeBox(a,c||{});return this});
tQuery.World.register("addThreeBox",function(a,c){console.assert(this.hasThreeBox()!==true);c=tQuery.extend(c,{cameraControls:true,cursor:true,controlClass:ThreeBox.OrbitControls,elementResize:true,fullscreen:true,scaleFactor:1,screenshot:true,stats:true});this.tRenderer().domElement.style.display="block";var b={};tQuery.data(this,"_threeBoxContext",b);var e=this.tCamera(),d=this.tRenderer();if(c.stats){b.stats=new Stats;b.stats.domElement.style.position="absolute";b.stats.domElement.style.left="10px";
b.stats.domElement.style.top="10px";a&&a.appendChild(b.stats.domElement);b.loopStats=function(){b.stats.update()};this.loop().hook(b.loopStats)}if(c.cameraControls){var g=this.loop(),f=this.render.bind(this);b.cameraControls=ThreeBox.OrbitControls.bind(e,a,c).on("change",function(){g._timerId||f()});this.setCameraControls(b.cameraControls)}if(c.elementResize)b.elementResize=ThreeBox.ElementResize.bind(d,e,a,c.scaleFactor);if(c.cursor!==null)b.cursor=ThreeBox.Cursor.bind(a,c);if(c.screenshot)b.screenshot=
THREEx.Screenshot.bindKey(d);if(c.fullscreen&&THREEx.FullScreen.available())b.fullscreen=THREEx.FullScreen.bindKey();b._$onDestroy=this.bind("destroy",function(){this.hasThreeBox()!==false&&this.removeThreeBox()});return this});tQuery.World.register("hasThreeBox",function(){return tQuery.data(this,"_threeBoxContext")===void 0?false:true});
tQuery.World.register("removeThreeBox",function(){var a=tQuery.data(this,"_threeBoxContext");if(a===void 0)return this;tQuery.removeData(this,"_threeBoxContext");this.unbind("destroy",this._$onDestroy);if(a.stats){document.body.removeChild(a.stats.domElement);this.loop().unhook(a.loopStats)}a.cameraControls&&this.removeCameraControls()&&a.cameraControls.stop();a.elementResize&&a.elementResize.unbind();a.cursor&&a.cursor.unbind();a.screenshot&&a.screenshot.unbind();a.fullscreen&&a.fullscreen.unbind()});
ThreeBox.ElementResize=function(a,c,b,e){var e=e||1,d=function(){var d=b.offsetWidth,f=b.offsetHeight,h=Math.floor(d/e),j=Math.floor(f/e);a.domElement.style.position="absolute";a.domElement.style.width=d+"px";a.domElement.style.height=f+"px";a.setSize(h,j);c.aspect=d/f;c.updateProjectionMatrix()};window.addEventListener("resize",d,false);b.addEventListener("resize",d,false);d();return{unbind:function(){window.removeEventListener("resize",d);b.removeEventListener("resize",d)}}};
ThreeBox.ElementResize.bind=function(a,c,b){return ThreeBox.ElementResize(a,c,b)};ThreeBox.OrbitControls=function(a,c,b){this.element=c;this.camera=a;this.options=tQuery.extend(b,{phi:\u03c4/4,theta:0,orbit:2,lookAt:[0,0,0],speed:2});this.init();this.start();this.update()};
ThreeBox.OrbitControls.prototype={init:function(){this.width=this.element.offsetWidth;this.height=this.element.offsetHeight;this.phi=this.options.phi;this.theta=this.options.theta;this.orbit=this.options.orbit;this.speed=this.options.speed;this.lookAt=new THREE.Vector3;this.lookAt.set.apply(this.lookAt,this.options.lookAt||[])},start:function(){var a=this;this._mouseDown=function(a){this.drag=true;this.lastHover=this.origin={x:a.pageX,y:a.pageY};a.preventDefault()}.bind(this);this._mouseUp=function(){this.drag=
false}.bind(this);this._mouseMove=function(){if(a.drag){var c={x:event.pageX-a.origin.x,y:event.pageY-a.origin.y},b={x:event.pageX-a.lastHover.x,y:event.pageY-a.lastHover.y};a.lastHover={x:event.pageX,y:event.pageY};a.moved(a.origin,c,b)}}.bind(this);this.element.addEventListener("mousedown",this._mouseDown,false);document.addEventListener("mouseup",this._mouseUp,false);document.addEventListener("mousemove",this._mouseMove,false)},stop:function(){this.element.removeEventListener("mousedown",this._mouseDown);
document.removeEventListener("mouseup",this._mouseUp);document.removeEventListener("mousemove",this._mouseMove)},moved:function(a,c,b){this.phi=this.phi+b.x*this.speed/this.width;this.theta=Math.min(\u03c0/2,Math.max(-\u03c0/2,this.theta+b.y*this.speed/this.height));this.emit("change")},update:function(){this.camera.position.x=Math.cos(this.phi)*Math.cos(this.theta)*this.orbit;this.camera.position.y=Math.sin(this.theta)*this.orbit;this.camera.position.z=Math.sin(this.phi)*Math.cos(this.theta)*this.orbit;
this.camera.position.addSelf(this.lookAt);this.camera.lookAt(this.lookAt)}};ThreeBox.MicroeventMixin(ThreeBox.OrbitControls);ThreeBox.OrbitControls.bind=function(a,c,b){return new ThreeBox.OrbitControls(a,c,b)};
ThreeBox.Cursor=function(a,c){function b(){if(!g)a.style.cursor=e;clearTimeout(d);g=false;d=setTimeout(function(){g=true;a.style.cursor="none"},f)}var e=c.cameraControls?"move":"default",d=null,g=false,f=2E3;if(c.cursor)a.style.cursor=e;else{a.addEventListener("mousemove",b);a.style.cursor="none"}return{unbind:function(){a.removeEventListener("mousemove",b)}}};ThreeBox.Cursor.bind=function(a,c){return ThreeBox.Cursor(a,c)};
